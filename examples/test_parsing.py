from minference.threads.models import RawOutput, LLMClient
from typing import Dict, Any, Optional
import json
from datetime import datetime
from openai.types.chat import ChatCompletion
from openai.types.chat.chat_completion_message import ChatCompletionMessage
from openai.types.chat.chat_completion_message_tool_call import ChatCompletionMessageToolCall, Function as ChatCompletionMessageToolCallFunction

from pydantic import BaseModel, Field
from typing import Dict, List, Optional

class Action(BaseModel):
    """
    Represents a concrete physical action between entities in a narrative text.
    """
    # Source entity information
    source: str = Field(..., description="Name of the entity performing the action")
    source_type: str = Field(..., description="Category of the source (person, animal, object, location)")
    source_is_character: bool = Field(..., description="Whether the source is a named character")
    
    # Target entity information
    target: str = Field(..., description="Name of the entity receiving the action")
    target_type: str = Field(..., description="Category of the target (person, animal, object, location)")
    target_is_character: bool = Field(..., description="Whether the target is a named character")
    
    # Action details
    action: str = Field(..., description="The verb or short phrase describing the physical interaction")
    consequence: str = Field(..., description="The immediate outcome or result of the action")
    
    # Text evidence
    text_describing_the_action: str = Field(..., description="Text fragment describing the action")
    text_describing_the_consequence: str = Field(..., description="Description of the consequence")
    
    # Context information
    location: List[str] = Field(..., description="Hierarchical location from global to local")
    temporal_order_id: int = Field(..., description="Sequential identifier for chronological order")
    
    def __str__(self) -> str:
        """String representation of the Action for human-readable output."""
        return (
            f"{self.source} ({self.source_type}) {self.action} "
            f"{self.target} ({self.target_type}) at {self.location[-1]}, "
            f"resulting in {self.consequence}"
        )

class NarrativeAnalysis(BaseModel):
    """
    Simplified analysis of narrative text with entities as strings and actions indexed by name.
    """
    text_id: str = Field(..., description="Unique identifier for the analyzed text segment")
    
    text_had_no_actions: bool = Field(
        default=False,
        description="Whether the text had no actions to extract"
    )
    
    text_had_no_actions_explanation: Optional[str] = Field(
        default=None,
        description="Explanation of why no actions were found if text_had_no_actions is true"
    )
    
    # Simple lists of entity names instead of full objects
    entity_names: List[str] = Field(
        default_factory=list,
        description="List of all distinct entity names in the text"
    )
    
    entity_types: Dict[str, str] = Field(
        default_factory=dict,
        description="Mapping of entity names to their types (person, animal, object, location)"
    )
    
    character_entities: List[str] = Field(
        default_factory=list,
        description="List of entity names that are characters in the narrative"
    )
    
    # Entity mentions mapping
    entity_mentions: Dict[str, List[str]] = Field(
        default_factory=dict,
        description="Mapping of entity names to their textual mentions"
    )
    
    # Locations as simple list of paths
    locations: List[List[str]] = Field(
        default_factory=list,
        description="List of hierarchical location paths from global to local"
    )
    
    # Location descriptions
    location_descriptions: Dict[str, str] = Field(
        default_factory=dict,
        description="Mapping of location string representations to their descriptions"
    )
    action_names: List[str] = Field(
        default_factory=list,
        description="List of all action names in the text"
    )
    
    # Actions indexed by name
    actions: Dict[str, Action] = Field(
        default_factory=dict,
        description="Dictionary mapping action names to Action objects"
    )
    
    def get_action_names(self) -> List[str]:
        """Return all action names."""
        return list(self.actions.keys())
    
    def get_entity_type(self, entity_name: str) -> str:
        """Get the type of an entity by name."""
        return self.entity_types.get(entity_name, "unknown")
    
    def is_character(self, entity_name: str) -> bool:
        """Check if an entity is a character."""
        return entity_name in self.character_entities
    
    def get_mentions(self, entity_name: str) -> List[str]:
        """Get all mentions of an entity."""
        return self.entity_mentions.get(entity_name, [])
    
    def get_location_description(self, location_path: List[str]) -> str:
        """Get the description of a location."""
        location_key = "->".join(location_path)
        return self.location_descriptions.get(location_key, "")




test_4 ={'id': 'chatcmpl-e59688dbd571455caf5e8c3700c67505', 'object': 'chat.completion', 'created': 1742948582, 'model': 'Qwen/Qwen2.5-32B-Instruct', 'choices': [{'index': 0, 'message': {'role': 'assistant', 'reasoning_content': None, 'content': '', 'tool_calls': [{'id': 'chatcmpl-tool-81124951d51247a9807e52f42039a03a', 'type': 'function', 'function': {'name': 'narrativeanalysis', 'arguments': '<tool_call>\n{"name": "narrativeanalysis", "arguments": {"text_id": "alice-in-wonderland-excerpt", "entity_names": ["Alice", "mushroom", "garden", "little house", "footman", "wood", "Duchess", "Queen"], "entity_types": {"Alice": "person", "mushroom": "object", "garden": "location", "little house": "location", "footman": "person", "wood": "location", "Duchess": "person", "Queen": "person"}, "character_entities": ["Alice", "footman", "Duchess", "Queen"], "entity_mentions": {"Alice": ["she", "her", "herself"], "mushroom": ["mushroom", "pieces of mushroom", "bit", "bits"], "garden": ["garden"], "little house": ["little house"], "footman": ["footman", "him", "his"], "wood": ["wood"], "Duchess": ["Duchess"], "Queen": ["Queen"]}, "locations": [["wood", "little house"]], "location_descriptions": {"wood->little house": "A small house in a wood"}, "action_names": ["untwist", "remember", "set to work", "nibble", "grow", "talk to herself", "come upon", "think", "begin nibbling", "stand", "wonder", "run out", "rap", "open", "notice", "feel curious", "creep out", "produce", "hand over", "say"}, "actions": {"untwist": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "mushroom", "target_type": "object", "target_is_character": false, "action": "untwist", "consequence": "Alice untwists the mushroom", "text_describing_the_action": "now and then she had to stop and untwist it", "text_describing_the_consequence": "Alice untwists the mushroom", "location": ["wood"], "temporal_order_id": 1}, "remember": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "remember", "consequence": "Alice recalls holding the mushroom", "text_describing_the_action": "she remembered that she still held the pieces of mushroom in her hands", "text_describing_the_consequence": "Alice remembers she has the mushroom", "location": ["wood"], "temporal_order_id": 2}, "set to work": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "mushroom", "target_type": "object", "target_is_character": false, "action": "set to work", "consequence": "Alice begins to nibble the mushroom", "text_describing_the_action": "she set to work very carefully, nibbling first at one and then at the other", "text_describing_the_consequence": "Alice starts nibbling the mushroom", "location": ["wood"], "temporal_order_id": 3}, "nibble": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "mushroom", "target_type": "object", "target_is_character": false, "action": "nibble", "consequence": "Alice changes her size", "text_describing_the_action": "nibbling first at one and then at the other", "text_describing_the_consequence": "Alice grows taller and shorter", "location": ["wood"], "temporal_order_id": 4}, "grow": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "grow", "consequence": "Alice changes her height", "text_describing_the_action": "growing sometimes taller and sometimes shorter", "text_describing_the_consequence": "Alice\'s height changes", "location": ["wood"], "temporal_order_id": 5}, "talk to herself": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "talk to herself", "consequence": "Alice verbalizes her thoughts", "text_describing_the_action": "began talking to herself, as usual", "text_describing_the_consequence": "Alice speaks her thoughts aloud", "location": ["wood"], "temporal_order_id": 6}, "come upon": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "little house", "target_type": "location", "target_is_character": false, "action": "come upon", "consequence": "Alice discovers the little house", "text_describing_the_action": "she came suddenly upon an open place, with a little house in it", "text_describing_the_consequence": "Alice finds the little house", "location": ["wood", "little house"], "temporal_order_id": 7}, "think": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "little house", "target_type": "location", "target_is_character": false, "action": "think", "consequence": "Alice considers the size issue", "text_describing_the_action": "thought Alice, it’ll never do to come upon them this size", "text_describing_the_consequence": "Alice decides she needs to be smaller", "location": ["wood", "little house"], "temporal_order_id": 8}, "begin nibbling": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "mushroom", "target_type": "object", "target_is_character": false, "action": "begin nibbling", "consequence": "Alice reduces her size", "text_describing_the_action": "So she began nibbling at the righthand bit again", "text_describing_the_consequence": "Alice brings herself down to nine inches high", "location": ["wood", "little house"], "temporal_order_id": 9}, "stand": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "little house", "target_type": "location", "target_is_character": false, "action": "stand", "consequence": "Alice observes the house", "text_describing_the_action": "For a minute or two she stood looking at the house", "text_describing_the_consequence": "Alice is standing and looking at the house", "location": ["wood", "little house"], "temporal_order_id": 10}, "wonder": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "little house", "target_type": "location", "target_is_character": false, "action": "wonder", "consequence": "Alice ponders her next move", "text_describing_the_action": "wondering what to do next", "text_describing_the_consequence": "Alice is considering her next action", "location": ["wood", "little house"], "temporal_order_id": 11}, "run out": {"source": "footman", "source_type": "person", "source_is_character": true, "target": "wood", "target_type": "location", "target_is_character": false, "action": "run out", "consequence": "The footman exits the wood", "text_describing_the_action": "a footman in livery came running out of the wood", "text_describing_the_consequence": "The footman is now outside the wood", "location": ["wood"], "temporal_order_id": 12}, "rap": {"source": "footman", "source_type": "person", "source_is_character": true, "target": "door", "target_type": "object", "target_is_character": false, "action": "rap", "consequence": "The door is knocked on", "text_describing_the_action": "rapped loudly at the door with his knuckles", "text_describing_the_consequence": "The door is knocked on loudly", "location": ["wood", "little house"], "temporal_order_id": 13}, "open": {"source": "footman", "source_type": "person", "source_is_character": true, "target": "door", "target_type": "object", "target_is_character": false, "action": "open", "consequence": "The door is opened", "text_describing_the_action": "It was opened by another footman in livery", "text_describing_the_consequence": "The door is now open", "location": ["wood", "little house"], "temporal_order_id": 14}, "notice": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "footman", "target_type": "person", "target_is_character": true, "action": "notice", "consequence": "Alice observes the footmen", "text_describing_the_action": "Alice noticed, had powdered hair that curled all over their heads", "text_describing_the_consequence": "Alice notices the footmen\'s appearance", "location": ["wood", "little house"], "temporal_order_id": 15}, "feel curious": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "footman", "target_type": "person", "target_is_character": true, "action": "feel curious", "consequence": "Alice is intrigued by the situation", "text_describing_the_action": "She felt very curious to know what it was all about", "text_describing_the_consequence": "Alice is curious about the footmen\'s actions", "location": ["wood", "little house"], "temporal_order_id": 16}, "creep out": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "wood", "target_type": "location", "target_is_character": false, "action": "creep out", "consequence": "Alice moves closer to the house", "text_describing_the_action": "crept a little way out of the wood to listen", "text_describing_the_consequence": "Alice is now closer to the house", "location": ["wood", "little house"], "temporal_order_id": 17}, "produce": {"source": "footman", "source_type": "person", "source_is_character": true, "target": "letter", "target_type": "object", "target_is_character": false, "action": "produce", "consequence": "The letter is revealed", "text_describing_the_action": "The Fish-Footman began by producing from under his arm a great letter", "text_describing_the_consequence": "The letter is now visible", "location": ["wood", "little house"], "temporal_order_id": 18}, "hand over": {"source": "footman", "source_type": "person", "source_is_character": true, "target": "footman", "target_type": "person", "target_is_character": true, "action": "hand over", "consequence": "The letter is transferred", "text_describing_the_action": "this he handed over to the other", "text_describing_the_consequence": "The letter is given to the other footman", "location": ["wood", "little house"], "temporal_order_id": 19}, "say": {"source": "footman", "source_type": "person", "source_is_character": true, "target": "footman", "target_type": "person", "target_is_character": true, "action": "say", "consequence": "The footman communicates", "text_describing_the_action": "saying, in a solemn tone, For the Duchess. An invitation from the Queen to play", "text_describing_the_consequence": "The footman delivers the message", "location": ["wood", "little house"], "temporal_order_id": 20}}}}\n</tool_call>'}}]}, 'logprobs': None, 'finish_reason': 'stop', 'stop_reason': None}], 'usage': {'prompt_tokens': 7061, 'total_tokens': 9764, 'completion_tokens': 2703, 'prompt_tokens_details': None}, 'prompt_logprobs': None}




test_5 ={'id': 'chatcmpl-11d8085534ba4279b2fcfffc111f466b', 'object': 'chat.completion', 'created': 1742948582, 'model': 'Qwen/Qwen2.5-32B-Instruct', 'choices': [{'index': 0, 'message': {'role': 'assistant', 'reasoning_content': None, 'content': '', 'tool_calls': [{'id': 'chatcmpl-tool-d3cbe2fcf74f49e0baaa24f8c4316e89', 'type': 'function', 'function': {'name': 'narrativeanalysis', 'arguments': '<tool_call>\n{"name": "narrativeanalysis", "arguments": {"text_id": "alice-dream", "entity_names": ["Lizard", "Bill", "King", "Queen", "Alice", "sister", "jury", "pack of cards"], "entity_types": {"Lizard": "person", "Bill": "person", "King": "person", "Queen": "person", "Alice": "person", "sister": "person", "jury": "object", "pack of cards": "object"}, "character_entities": ["Lizard", "Bill", "King", "Queen", "Alice", "sister"], "entity_mentions": {"Lizard": ["Lizard"], "Bill": ["Bill", "he"], "King": ["King"], "Queen": ["Queen"], "Alice": ["Alice"], "sister": ["sister"], "jury": ["jury"], "pack of cards": ["pack of cards", "cards"]}, "locations": [["court"], ["bank"]], "location_descriptions": {"court": "The location of the trial with the King and Queen", "bank": "The location where Alice wakes up with her sister"}, "action_names": ["spoke", "left off writing", "began again", "looked round", "laughed", "consider", "said", "shouted", "moved", "cared for", "rose up", "came flying down", "screamed", "tried to beat off", "found herself lying", "brushing away", "woke up", "kissed", "ran off", "sat still", "watching", "thinking"}, "actions": {"spoke": {"source": "Lizard", "source_type": "person", "source_is_character": true, "target": "narrator", "target_type": "object", "target_is_character": false, "action": "spoke", "consequence": "Lizard communicated with the narrator", "text_describing_the_action": "Lizard as she spoke", "text_describing_the_consequence": "Lizard\'s words were heard", "location": ["court"], "temporal_order_id": 1}, "left off writing": {"source": "Bill", "source_type": "person", "source_is_character": true, "target": "slate", "target_type": "object", "target_is_character": false, "action": "left off writing", "consequence": "Bill stopped writing on the slate", "text_describing_the_action": "had left off writing on his slate", "text_describing_the_consequence": "Bill stopped writing", "location": ["court"], "temporal_order_id": 2}, "began again": {"source": "Bill", "source_type": "person", "source_is_character": true, "target": "slate", "target_type": "object", "target_is_character": false, "action": "began again", "consequence": "Bill resumed writing on the slate", "text_describing_the_action": "hastily began again", "text_describing_the_consequence": "Bill resumed writing", "location": ["court"], "temporal_order_id": 3}, "looked round": {"source": "King", "source_type": "person", "source_is_character": true, "target": "court", "target_type": "location", "target_is_character": false, "action": "looked round", "consequence": "King surveyed the court", "text_describing_the_action": "looking round the court", "text_describing_the_consequence": "King observed the court", "location": ["court"], "temporal_order_id": 4}, "laughed": {"source": "everybody", "source_type": "object", "source_is_character": false, "target": "King", "target_type": "person", "target_is_character": true, "action": "laughed", "consequence": "Everyone responded to the King\'s statement", "text_describing_the_action": "everybody laughed", "text_describing_the_consequence": "Everyone showed amusement", "location": ["court"], "temporal_order_id": 5}, "consider": {"source": "jury", "source_type": "object", "source_is_character": false, "target": "verdict", "target_type": "object", "target_is_character": false, "action": "consider", "consequence": "Jury began to deliberate", "text_describing_the_action": "Let the jury consider their verdict", "text_describing_the_consequence": "Jury started to deliberate", "location": ["court"], "temporal_order_id": 6}, "said": {"source": "Queen", "source_type": "person", "source_is_character": true, "target": "King", "target_type": "person", "target_is_character": true, "action": "said", "consequence": "Queen communicated with the King", "text_describing_the_action": "“No, no!” said the Queen", "text_describing_the_consequence": "Queen expressed disagreement", "location": ["court"], "temporal_order_id": 7}, "shouted": {"source": "Queen", "source_type": "person", "source_is_character": true, "target": "narrator", "target_type": "object", "target_is_character": false, "action": "shouted", "consequence": "Queen\'s voice was heard", "text_describing_the_action": "the Queen shouted at the top of her voice", "text_describing_the_consequence": "Queen\'s voice was loud", "location": ["court"], "temporal_order_id": 8}, "moved": {"source": "nobody", "source_type": "object", "source_is_character": false, "target": "Queen", "target_type": "person", "target_is_character": true, "action": "moved", "consequence": "No one responded to the Queen\'s command", "text_describing_the_action": "Nobody moved", "text_describing_the_consequence": "No one acted on the Queen\'s command", "location": ["court"], "temporal_order_id": 9}, "cared for": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "Queen", "target_type": "person", "target_is_character": true, "action": "cared for", "consequence": "Alice expressed disregard for the Queen", "text_describing_the_action": "“Who cares for you?” said Alice", "text_describing_the_consequence": "Alice showed indifference", "location": ["court"], "temporal_order_id": 10}, "rose up": {"source": "pack of cards", "source_type": "object", "source_is_character": false, "target": "air", "target_type": "object", "target_is_character": false, "action": "rose up", "consequence": "The cards ascended into the air", "text_describing_the_action": "the whole pack rose up into the air", "text_describing_the_consequence": "The cards were in the air", "location": ["court"], "temporal_order_id": 11}, "came flying down": {"source": "pack of cards", "source_type": "object", "source_is_character": false, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "came flying down", "consequence": "The cards descended towards Alice", "text_describing_the_action": "came flying down upon her", "text_describing_the_consequence": "The cards were descending towards Alice", "location": ["court"], "temporal_order_id": 12}, "screamed": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "narrator", "target_type": "object", "target_is_character": false, "action": "screamed", "consequence": "Alice expressed fear and anger", "text_describing_the_action": "she gave a little scream", "text_describing_the_consequence": "Alice\'s scream was heard", "location": ["court"], "temporal_order_id": 13}, "tried to beat off": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "pack of cards", "target_type": "object", "target_is_character": false, "action": "tried to beat off", "consequence": "Alice attempted to fend off the cards", "text_describing_the_action": "and tried to beat them off", "text_describing_the_consequence": "Alice attempted to fend off the cards", "location": ["court"], "temporal_order_id": 14}, "found herself lying": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "bank", "target_type": "location", "target_is_character": false, "action": "found herself lying", "consequence": "Alice was on the bank", "text_describing_the_action": "and found herself lying on the bank", "text_describing_the_consequence": "Alice was on the bank", "location": ["bank"], "temporal_order_id": 15}, "brushing away": {"source": "sister", "source_type": "person", "source_is_character": true, "target": "dead leaves", "target_type": "object", "target_is_character": false, "action": "brushing away", "consequence": "Sister removed the leaves from Alice\'s face", "text_describing_the_action": "who was gently brushing away some dead leaves", "text_describing_the_consequence": "The leaves were removed from Alice\'s face", "location": ["bank"], "temporal_order_id": 16}, "woke up": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "narrator", "target_type": "object", "target_is_character": false, "action": "woke up", "consequence": "Alice regained consciousness", "text_describing_the_action": "Wake up, Alice dear!", "text_describing_the_consequence": "Alice woke up", "location": ["bank"], "temporal_order_id": 17}, "kissed": {"source": "sister", "source_type": "person", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "kissed", "consequence": "Sister showed affection to Alice", "text_describing_the_action": "her sister kissed her", "text_describing_the_consequence": "Sister kissed Alice", "location": ["bank"], "temporal_order_id": 18}, "ran off": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "narrator", "target_type": "object", "target_is_character": false, "action": "ran off", "consequence": "Alice left the bank", "text_describing_the_action": "Alice got up and ran off", "text_describing_the_consequence": "Alice left the bank", "location": ["bank"], "temporal_order_id": 19}, "sat still": {"source": "sister", "source_type": "person", "source_is_character": true, "target": "bank", "target_type": "location", "target_is_character": false, "action": "sat still", "consequence": "Sister remained seated", "text_describing_the_action": "But her sister sat still just as she left her", "text_describing_the_consequence": "Sister remained seated", "location": ["bank"], "temporal_order_id": 20}, "watching": {"source": "sister", "source_type": "person", "source_is_character": true, "target": "setting sun", "target_type": "object", "target_is_character": false, "action": "watching", "consequence": "Sister observed the sunset", "text_describing_the_action": "watching the setting sun", "text_describing_the_consequence": "Sister observed the sunset", "location": ["bank"], "temporal_order_id": 21}, "thinking": {"source": "sister", "source_type": "person", "source_is_character": true, "target": "little Alice and all her wonderful Adventures", "target_type": "object", "target_is_character": false, "action": "thinking", "consequence": "Sister reflected on Alice\'s adventures", "text_describing_the_action": "thinking of little Alice and all her wonderful Adventures", "text_describing_the_consequence": "Sister reflected on Alice\'s adventures", "location": ["bank"], "temporal_order_id": 22}}}}\n</tool_call>'}}]}, 'logprobs': None, 'finish_reason': 'stop', 'stop_reason': None}], 'usage': {'prompt_tokens': 7068, 'total_tokens': 9856, 'completion_tokens': 2788, 'prompt_tokens_details': None}, 'prompt_logprobs': None}
test_6 ={'id': 'chatcmpl-bad2ef49e21644e4b3b7135bd8de44ad', 'object': 'chat.completion', 'created': 1742948582, 'model': 'Qwen/Qwen2.5-32B-Instruct', 'choices': [{'index': 0, 'message': {'role': 'assistant', 'reasoning_content': None, 'content': '', 'tool_calls': [{'id': 'chatcmpl-tool-30d65cef024b4a779326e1c2a74f9a16', 'type': 'function', 'function': {'name': 'narrativeanalysis', 'arguments': '<tool_call>\n{"name": "narrativeanalysis", "arguments": {"text_id": "alice_dormouse_scene", "entity_names": ["Treacle", "Dormouse", "Queen", "King", "Alice", "White Rabbit", "jury-box", "jurymen", "crowd", "Lizard"], "entity_types": {"Treacle": "object", "Dormouse": "animal", "Queen": "person", "King": "person", "Alice": "person", "White Rabbit": "animal", "jury-box": "object", "jurymen": "person", "crowd": "group", "Lizard": "animal"}, "character_entities": ["Dormouse", "Queen", "King", "Alice", "White Rabbit", "Lizard"], "entity_mentions": {"Treacle": ["Treacle"], "Dormouse": ["Dormouse"], "Queen": ["Queen"], "King": ["King"], "Alice": ["Alice"], "White Rabbit": ["White Rabbit"], "jury-box": ["jury-box"], "jurymen": ["jurymen"], "crowd": ["crowd"], "Lizard": ["Lizard"]}, "locations": [["court"], ["jury-box"], ["crowd"]], "location_descriptions": {"court": "The courtroom where the trial is taking place", "jury-box": "The box where the jurymen sit", "crowd": "The crowd below the jury-box"}, "action_names": ["say", "shriek", "turn out", "disappear", "settle down", "say", "add", "watch", "fumble", "jump", "tip over", "upset", "lie", "pick up", "put back", "say", "look", "put", "wave", "get out"}, "actions": {"say": {"source": "Treacle", "source_type": "object", "source_is_character": false, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "say", "consequence": "Alice hears the sleepy voice", "text_describing_the_action": "“Treacle,” said a sleepy voice behind her.", "text_describing_the_consequence": "Alice hears the voice", "location": ["court"], "temporal_order_id": 1}, "shriek": {"source": "Queen", "source_type": "person", "source_is_character": true, "target": "Dormouse", "target_type": "animal", "target_is_character": true, "action": "shriek", "consequence": "The Queen demands actions against the Dormouse", "text_describing_the_action": "“Collar that Dormouse,” the Queen shrieked out. “Behead that Dormouse! Turn that Dormouse out of court! Suppress him! Pinch him! Off with his whiskers!”", "text_describing_the_consequence": "The court is in confusion", "location": ["court"], "temporal_order_id": 2}, "turn out": {"source": "court", "source_type": "location", "source_is_character": false, "target": "Dormouse", "target_type": "animal", "target_is_character": true, "action": "turn out", "consequence": "The Dormouse is removed from the court", "text_describing_the_action": "For some minutes the whole court was in confusion, getting the Dormouse turned out", "text_describing_the_consequence": "The Dormouse is no longer in the court", "location": ["court"], "temporal_order_id": 3}, "disappear": {"source": "cook", "source_type": "person", "source_is_character": false, "target": "court", "target_type": "location", "target_is_character": false, "action": "disappear", "consequence": "The cook is no longer present", "text_describing_the_action": "and, by the time they had settled down again, the cook had disappeared.", "text_describing_the_consequence": "The cook is gone", "location": ["court"], "temporal_order_id": 4}, "settle down": {"source": "court", "source_type": "location", "source_is_character": false, "target": "court", "target_type": "location", "target_is_character": false, "action": "settle down", "consequence": "The court regains order", "text_describing_the_action": "For some minutes the whole court was in confusion, getting the Dormouse turned out, and, by the time they had settled down again", "text_describing_the_consequence": "The court is calm again", "location": ["court"], "temporal_order_id": 5}, "say": {"source": "King", "source_type": "person", "source_is_character": true, "target": "court", "target_type": "location", "target_is_character": false, "action": "say", "consequence": "The King expresses relief", "text_describing_the_action": "“Never mind!” said the King, with an air of great relief.", "text_describing_the_consequence": "The King is relieved", "location": ["court"], "temporal_order_id": 6}, "add": {"source": "King", "source_type": "person", "source_is_character": true, "target": "Queen", "target_type": "person", "target_is_character": true, "action": "add", "consequence": "The King speaks to the Queen", "text_describing_the_action": "And he added in an undertone to the Queen, “Really, my dear, you must cross-examine the next witness. It quite makes my forehead ache!”", "text_describing_the_consequence": "The Queen is instructed to cross-examine", "location": ["court"], "temporal_order_id": 7}, "watch": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "White Rabbit", "target_type": "animal", "target_is_character": true, "action": "watch", "consequence": "Alice observes the White Rabbit", "text_describing_the_action": "Alice watched the White Rabbit as he fumbled over the list", "text_describing_the_consequence": "Alice is observing the White Rabbit", "location": ["court"], "temporal_order_id": 8}, "fumble": {"source": "White Rabbit", "source_type": "animal", "source_is_character": true, "target": "list", "target_type": "object", "target_is_character": false, "action": "fumble", "consequence": "The White Rabbit is handling the list", "text_describing_the_action": "Alice watched the White Rabbit as he fumbled over the list", "text_describing_the_consequence": "The White Rabbit is handling the list", "location": ["court"], "temporal_order_id": 9}, "jump": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "court", "target_type": "location", "target_is_character": false, "action": "jump", "consequence": "Alice moves suddenly", "text_describing_the_action": "Alice jumped up in such a hurry", "text_describing_the_consequence": "Alice is standing up", "location": ["court"], "temporal_order_id": 10}, "tip over": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "jury-box", "target_type": "object", "target_is_character": false, "action": "tip over", "consequence": "The jury-box is knocked over", "text_describing_the_action": "she tipped over the jury-box with the edge of her skirt", "text_describing_the_consequence": "The jury-box is overturned", "location": ["court"], "temporal_order_id": 11}, "upset": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "jurymen", "target_type": "person", "target_is_character": true, "action": "upset", "consequence": "The jurymen fall", "text_describing_the_action": "upsetting all the jurymen on to the heads of the crowd below", "text_describing_the_consequence": "The jurymen are on the ground", "location": ["court"], "temporal_order_id": 12}, "lie": {"source": "jurymen", "source_type": "person", "source_is_character": true, "target": "crowd", "target_type": "group", "target_is_character": false, "action": "lie", "consequence": "The jurymen are sprawled out", "text_describing_the_action": "and there they lay sprawling about", "text_describing_the_consequence": "The jurymen are sprawled out", "location": ["crowd"], "temporal_order_id": 13}, "pick up": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "jurymen", "target_type": "person", "target_is_character": true, "action": "pick up", "consequence": "Alice is gathering the jurymen", "text_describing_the_action": "she began picking them up again as quickly as she could", "text_describing_the_consequence": "Alice is gathering the jurymen", "location": ["court"], "temporal_order_id": 14}, "put back": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "jurymen", "target_type": "person", "target_is_character": true, "action": "put back", "consequence": "The jurymen are returned to the jury-box", "text_describing_the_action": "she had a vague sort of idea that they must be collected at once and put back into the jury-box", "text_describing_the_consequence": "The jurymen are back in the jury-box", "location": ["court"], "temporal_order_id": 15}, "say": {"source": "King", "source_type": "person", "source_is_character": true, "target": "court", "target_type": "location", "target_is_character": false, "action": "say", "consequence": "The King states the trial cannot proceed", "text_describing_the_action": "“The trial cannot proceed,” said the King in a very grave voice,", "text_describing_the_consequence": "The trial is paused", "location": ["court"], "temporal_order_id": 16}, "look": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "jury-box", "target_type": "object", "target_is_character": false, "action": "look", "consequence": "Alice observes the jury-box", "text_describing_the_action": "Alice looked at the jury-box", "text_describing_the_consequence": "Alice is observing the jury-box", "location": ["court"], "temporal_order_id": 17}, "put": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "Lizard", "target_type": "animal", "target_is_character": true, "action": "put", "consequence": "The Lizard is placed in the jury-box", "text_describing_the_action": "she saw that, in her haste, she had put the Lizard in head downwards", "text_describing_the_consequence": "The Lizard is in the jury-box", "location": ["court"], "temporal_order_id": 18}, "wave": {"source": "Lizard", "source_type": "animal", "source_is_character": true, "target": "Lizard", "target_type": "animal", "target_is_character": true, "action": "wave", "consequence": "The Lizard is moving its tail", "text_describing_the_action": "the poor little thing was waving its tail about in a melancholy way", "text_describing_the_consequence": "The Lizard\'s tail is moving", "location": ["court"], "temporal_order_id": 19}, "get out": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "Lizard", "target_type": "animal", "target_is_character": true, "action": "get out", "consequence": "The Lizard is removed from the jury-box", "text_describing_the_action": "She soon got it out again", "text_describing_the_consequence": "The Lizard is out of the jury-box", "location": ["court"], "temporal_order_id": 20}}}}\n</tool_call>'}}]}, 'logprobs': None, 'finish_reason': 'stop', 'stop_reason': None}], 'usage': {'prompt_tokens': 7060, 'total_tokens': 9857, 'completion_tokens': 2797, 'prompt_tokens_details': None}, 'prompt_logprobs': None}
test_7 ={'id': 'chatcmpl-382dabcbad3a45abb955776c8e524627', 'object': 'chat.completion', 'created': 1742948582, 'model': 'Qwen/Qwen2.5-32B-Instruct', 'choices': [{'index': 0, 'message': {'role': 'assistant', 'reasoning_content': None, 'content': '', 'tool_calls': [{'id': 'chatcmpl-tool-4afc12dce4fa4f9992bb03f2268bc6b4', 'type': 'function', 'function': {'name': 'narrativeanalysis', 'arguments': '<tool_call>\n{"name": "narrativeanalysis", "arguments": {"text_id": "alice-baby-interaction", "entity_names": ["Alice", "Duchess", "baby", "cook", "frying-pan", "room", "Queen", "open air"], "entity_types": {"Alice": "person", "Duchess": "person", "baby": "object", "cook": "person", "frying-pan": "object", "room": "location", "Queen": "person", "open air": "location"}, "character_entities": ["Alice", "Duchess", "cook", "Queen"], "entity_mentions": {"Alice": ["Alice"], "Duchess": ["Duchess"], "baby": ["baby", "it", "the poor little thing"], "cook": ["cook"], "frying-pan": ["frying-pan"], "room": ["room"], "Queen": ["Queen"], "open air": ["open air"]}, "locations": [["room"], ["open air"]], "location_descriptions": {"room": "A room where the Duchess and Alice are present", "open air": "The area outside the room"}, "action_names": ["speak", "beat", "enjoy", "throw", "get ready", "hurry out", "throw", "miss", "catch", "hold", "snort", "double", "straighten", "twist", "carry", "grunt", "look", "turn", "get small", "look", "sob", "look"}, "actions": {"speak": {"source": "Duchess", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "speak", "consequence": "The Duchess expresses her strictness towards her boy", "text_describing_the_action": "“I speak severely to my boy,", "text_describing_the_consequence": "The Duchess is expressing her strictness", "location": ["room"], "temporal_order_id": 1}, "beat": {"source": "Duchess", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "beat", "consequence": "The baby is physically punished", "text_describing_the_action": "I beat him when he sneezes;", "text_describing_the_consequence": "The baby is beaten", "location": ["room"], "temporal_order_id": 2}, "enjoy": {"source": "baby", "source_type": "object", "source_is_character": false, "target": "pepper", "target_type": "object", "target_is_character": false, "action": "enjoy", "consequence": "The baby enjoys the pepper", "text_describing_the_action": "For he can thoroughly enjoy", "text_describing_the_consequence": "The baby enjoys the pepper", "location": ["room"], "temporal_order_id": 3}, "throw": {"source": "Duchess", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "throw", "consequence": "The baby is thrown to Alice", "text_describing_the_action": "“Here! you may nurse it a bit, if you like!” the Duchess said to Alice, flinging the baby at her as she spoke.", "text_describing_the_consequence": "The baby is thrown to Alice", "location": ["room"], "temporal_order_id": 4}, "get ready": {"source": "Duchess", "source_type": "person", "source_is_character": true, "target": "Queen", "target_type": "person", "target_is_character": true, "action": "get ready", "consequence": "The Duchess prepares to play croquet with the Queen", "text_describing_the_action": "“I must go and get ready to play croquet with the Queen,”", "text_describing_the_consequence": "The Duchess is preparing to play croquet", "location": ["room"], "temporal_order_id": 5}, "hurry out": {"source": "Duchess", "source_type": "person", "source_is_character": true, "target": "room", "target_type": "location", "target_is_character": false, "action": "hurry out", "consequence": "The Duchess leaves the room", "text_describing_the_action": "and she hurried out of the room.", "text_describing_the_consequence": "The Duchess has left the room", "location": ["room"], "temporal_order_id": 6}, "throw": {"source": "cook", "source_type": "person", "source_is_character": true, "target": "Duchess", "target_type": "person", "target_is_character": true, "action": "throw", "consequence": "The frying-pan is thrown at the Duchess", "text_describing_the_action": "The cook threw a frying-pan after her as she went out,", "text_describing_the_consequence": "The frying-pan is thrown at the Duchess", "location": ["room"], "temporal_order_id": 7}, "miss": {"source": "frying-pan", "source_type": "object", "source_is_character": false, "target": "Duchess", "target_type": "person", "target_is_character": true, "action": "miss", "consequence": "The frying-pan does not hit the Duchess", "text_describing_the_action": "but it just missed her.", "text_describing_the_consequence": "The frying-pan misses the Duchess", "location": ["room"], "temporal_order_id": 8}, "catch": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "catch", "consequence": "Alice catches the baby", "text_describing_the_action": "Alice caught the baby with some difficulty,", "text_describing_the_consequence": "Alice has caught the baby", "location": ["room"], "temporal_order_id": 9}, "hold": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "hold", "consequence": "Alice holds the baby", "text_describing_the_action": "as it was a queer-shaped little creature, and held out its arms and legs in all directions,", "text_describing_the_consequence": "Alice is holding the baby", "location": ["room"], "temporal_order_id": 10}, "snort": {"source": "baby", "source_type": "object", "source_is_character": false, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "snort", "consequence": "The baby snorts like a steam-engine", "text_describing_the_action": "“The poor little thing was snorting like a steam-engine when she caught it,", "text_describing_the_consequence": "The baby is snorting", "location": ["room"], "temporal_order_id": 11}, "double": {"source": "baby", "source_type": "object", "source_is_character": false, "target": "itself", "target_type": "object", "target_is_character": false, "action": "double", "consequence": "The baby doubles itself up", "text_describing_the_action": "and kept doubling itself up and straightening itself out again,", "text_describing_the_consequence": "The baby is doubling itself up", "location": ["room"], "temporal_order_id": 12}, "straighten": {"source": "baby", "source_type": "object", "source_is_character": false, "target": "itself", "target_type": "object", "target_is_character": false, "action": "straighten", "consequence": "The baby straightens itself out", "text_describing_the_action": "and kept doubling itself up and straightening itself out again,", "text_describing_the_consequence": "The baby is straightening itself out", "location": ["room"], "temporal_order_id": 13}, "twist": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "twist", "consequence": "Alice twists the baby into a knot", "text_describing_the_action": "As soon as she had made out the proper way of nursing it, (which was to twist it up into a sort of knot,", "text_describing_the_consequence": "Alice has twisted the baby into a knot", "location": ["room"], "temporal_order_id": 14}, "carry": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "carry", "consequence": "Alice carries the baby out into the open air", "text_describing_the_action": "she carried it out into the open air.", "text_describing_the_consequence": "Alice is carrying the baby out into the open air", "location": ["room", "open air"], "temporal_order_id": 15}, "grunt": {"source": "baby", "source_type": "object", "source_is_character": false, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "grunt", "consequence": "The baby grunts in reply", "text_describing_the_action": "The little thing grunted in reply (it had left off sneezing by this time).", "text_describing_the_consequence": "The baby has grunted", "location": ["open air"], "temporal_order_id": 16}, "look": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "look", "consequence": "Alice looks anxiously into the baby\'s face", "text_describing_the_action": "Alice looked very anxiously into its face to see what was the matter with it.", "text_describing_the_consequence": "Alice is looking into the baby\'s face", "location": ["open air"], "temporal_order_id": 17}, "turn": {"source": "baby", "source_type": "object", "source_is_character": false, "target": "nose", "target_type": "object", "target_is_character": false, "action": "turn", "consequence": "The baby\'s nose is turning up", "text_describing_the_action": "There could be no doubt that it had a very turn-up nose,", "text_describing_the_consequence": "The baby\'s nose is turning up", "location": ["open air"], "temporal_order_id": 18}, "get small": {"source": "baby", "source_type": "object", "source_is_character": false, "target": "eyes", "target_type": "object", "target_is_character": false, "action": "get small", "consequence": "The baby\'s eyes are getting smaller", "text_describing_the_action": "also its eyes were getting extremely small for a baby:", "text_describing_the_consequence": "The baby\'s eyes are getting smaller", "location": ["open air"], "temporal_order_id": 19}, "look": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "look", "consequence": "Alice looks into the baby\'s eyes again", "text_describing_the_action": "Alice looked into its eyes again, to see if there were any tears.", "text_describing_the_consequence": "Alice is looking into the baby\'s eyes", "location": ["open air"], "temporal_order_id": 20}, "sob": {"source": "baby", "source_type": "object", "source_is_character": false, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "sob", "consequence": "The baby is sobbing", "text_describing_the_action": "“But perhaps it was only sobbing,” she thought,", "text_describing_the_consequence": "The baby is sobbing", "location": ["open air"], "temporal_order_id": 21}, "look": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "baby", "target_type": "object", "target_is_character": false, "action": "look", "consequence": "Alice looks into the baby\'s eyes again", "text_describing_the_action": "and looked into its eyes again, to see if there were any tears.", "text_describing_the_consequence": "Alice is looking into the baby\'s eyes", "location": ["open air"], "temporal_order_id": 22}}}}\n</tool_call>'}}]}, 'logprobs': None, 'finish_reason': 'stop', 'stop_reason': None}], 'usage': {'prompt_tokens': 7071, 'total_tokens': 10014, 'completion_tokens': 2943, 'prompt_tokens_details': None}, 'prompt_logprobs': None}
test_8 ={'id': 'chatcmpl-c60e8147d6f64a61948ed3e77283680f', 'object': 'chat.completion', 'created': 1742948582, 'model': 'Qwen/Qwen2.5-32B-Instruct', 'choices': [{'index': 0, 'message': {'role': 'assistant', 'reasoning_content': None, 'content': '', 'tool_calls': [{'id': 'chatcmpl-tool-986b5b0a4fcf48758f11df21c59031d9', 'type': 'function', 'function': {'name': 'narrativeanalysis', 'arguments': '<tool_call>\n{"name": "narrativeanalysis", "arguments": {"text_id": "alice-in-wonderland-excerpt", "entity_names": ["Alice", "Hatter", "Dormouse", "tree", "door", "little glass table", "little golden key", "garden", "mushroom", "rose-tree", "gardeners", "roses", "Queen"], "entity_types": {"Alice": "person", "Hatter": "person", "Dormouse": "animal", "tree": "object", "door": "object", "little glass table": "object", "little golden key": "object", "garden": "location", "mushroom": "object", "rose-tree": "object", "gardeners": "person", "roses": "object", "Queen": "person"}, "character_entities": ["Alice", "Hatter", "Dormouse", "gardeners", "Queen"], "entity_mentions": {"Alice": ["Alice"], "Hatter": ["Hatter"], "Dormouse": ["Dormouse"], "tree": ["tree"], "door": ["door"], "little glass table": ["little glass table"], "little golden key": ["little golden key"], "garden": ["garden"], "mushroom": ["mushroom"], "rose-tree": ["rose-tree"], "gardeners": ["gardeners"], "roses": ["roses"], "Queen": ["Queen"]}, "locations": [["wood", "tree"], ["hall", "little glass table"], ["garden", "rose-tree"]], "location_descriptions": {"wood->tree": "A wood with a tree having a door leading into it", "hall->little glass table": "A long hall with a little glass table", "garden->rose-tree": "A beautiful garden with a rose-tree near the entrance"}, "action_names": ["say", "get up", "walk off", "fall asleep", "look back", "try", "pick her way", "notice", "think", "go in", "find herself", "unlock", "walk down", "nibble", "find herself", "stand", "paint", "come up", "say", "say", "say", "say"}, "actions": {"say": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "Hatter", "target_type": "person", "target_is_character": true, "action": "say", "consequence": "Alice expresses her confusion", "text_describing_the_action": "“Really, now you ask me,” said Alice, very much confused, “I don’t think—”", "text_describing_the_consequence": "Alice is confused and unsure", "location": ["wood", "tree"], "temporal_order_id": 1}, "get up": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "get up", "consequence": "Alice rises from her seat", "text_describing_the_action": "she got up in great disgust", "text_describing_the_consequence": "Alice is standing", "location": ["wood", "tree"], "temporal_order_id": 2}, "walk off": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "wood", "target_type": "location", "target_is_character": false, "action": "walk off", "consequence": "Alice leaves the tea party", "text_describing_the_action": "and walked off", "text_describing_the_consequence": "Alice is no longer at the tea party", "location": ["wood", "tree"], "temporal_order_id": 3}, "fall asleep": {"source": "Dormouse", "source_type": "animal", "source_is_character": true, "target": "Dormouse", "target_type": "animal", "target_is_character": true, "action": "fall asleep", "consequence": "Dormouse is sleeping", "text_describing_the_action": "the Dormouse fell asleep instantly", "text_describing_the_consequence": "Dormouse is now asleep", "location": ["wood", "tree"], "temporal_order_id": 4}, "look back": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "tea party", "target_type": "location", "target_is_character": false, "action": "look back", "consequence": "Alice checks if anyone is calling her", "text_describing_the_action": "though she looked back once or twice", "text_describing_the_consequence": "Alice is checking if anyone is calling her", "location": ["wood", "tree"], "temporal_order_id": 5}, "try": {"source": "tea party", "source_type": "location", "source_is_character": false, "target": "Dormouse", "target_type": "animal", "target_is_character": true, "action": "try", "consequence": "The tea party attempts to put the Dormouse in the teapot", "text_describing_the_action": "they were trying to put the Dormouse into the teapot", "text_describing_the_consequence": "The Dormouse is being put into the teapot", "location": ["wood", "tree"], "temporal_order_id": 6}, "pick her way": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "wood", "target_type": "location", "target_is_character": false, "action": "pick her way", "consequence": "Alice navigates through the wood", "text_describing_the_action": "she picked her way through the wood", "text_describing_the_consequence": "Alice is moving through the wood", "location": ["wood", "tree"], "temporal_order_id": 7}, "notice": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "tree", "target_type": "object", "target_is_character": false, "action": "notice", "consequence": "Alice sees the door in the tree", "text_describing_the_action": "she noticed that one of the trees had a door leading right into it", "text_describing_the_consequence": "Alice is aware of the door", "location": ["wood", "tree"], "temporal_order_id": 8}, "think": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "think", "consequence": "Alice reflects on the curious situation", "text_describing_the_action": "“That’s very curious!” she thought", "text_describing_the_consequence": "Alice is thinking about the door", "location": ["wood", "tree"], "temporal_order_id": 9}, "go in": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "tree", "target_type": "object", "target_is_character": false, "action": "go in", "consequence": "Alice enters the tree", "text_describing_the_action": "And in she went", "text_describing_the_consequence": "Alice is inside the tree", "location": ["wood", "tree"], "temporal_order_id": 10}, "find herself": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "hall", "target_type": "location", "target_is_character": false, "action": "find herself", "consequence": "Alice is in the hall", "text_describing_the_action": "she found herself in the long hall", "text_describing_the_consequence": "Alice is now in the hall", "location": ["hall", "little glass table"], "temporal_order_id": 11}, "unlock": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "door", "target_type": "object", "target_is_character": false, "action": "unlock", "consequence": "The door is unlocked", "text_describing_the_action": "Alice began by taking the little golden key, and unlocking the door that led into the garden", "text_describing_the_consequence": "The door is now unlocked", "location": ["hall", "little glass table"], "temporal_order_id": 12}, "walk down": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "passage", "target_type": "location", "target_is_character": false, "action": "walk down", "consequence": "Alice moves through the passage", "text_describing_the_action": "then she walked down the little passage", "text_describing_the_consequence": "Alice is in the passage", "location": ["hall", "little glass table"], "temporal_order_id": 13}, "nibble": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "mushroom", "target_type": "object", "target_is_character": false, "action": "nibble", "consequence": "Alice changes her size", "text_describing_the_action": "till she was about a foot high", "text_describing_the_consequence": "Alice is now about a foot high", "location": ["hall", "little glass table"], "temporal_order_id": 14}, "find herself": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "garden", "target_type": "location", "target_is_character": false, "action": "find herself", "consequence": "Alice is in the garden", "text_describing_the_action": "she found herself at last in the beautiful garden", "text_describing_the_consequence": "Alice is now in the garden", "location": ["garden", "rose-tree"], "temporal_order_id": 15}, "stand": {"source": "rose-tree", "source_type": "object", "source_is_character": false, "target": "garden", "target_type": "location", "target_is_character": false, "action": "stand", "consequence": "The rose-tree is in place", "text_describing_the_action": "A large rose-tree stood near the entrance of the garden", "text_describing_the_consequence": "The rose-tree is near the garden entrance", "location": ["garden", "rose-tree"], "temporal_order_id": 16}, "paint": {"source": "gardeners", "source_type": "person", "source_is_character": true, "target": "roses", "target_type": "object", "target_is_character": false, "action": "paint", "consequence": "The roses are being painted red", "text_describing_the_action": "the roses growing on it were white, but there were three gardeners at it, busily painting them red", "text_describing_the_consequence": "The roses are being painted", "location": ["garden", "rose-tree"], "temporal_order_id": 17}, "come up": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "gardeners", "target_type": "person", "target_is_character": true, "action": "come up", "consequence": "Alice approaches the gardeners", "text_describing_the_action": "Alice went nearer to watch them", "text_describing_the_consequence": "Alice is near the gardeners", "location": ["garden", "rose-tree"], "temporal_order_id": 18}, "say": {"source": "gardeners", "source_type": "person", "source_is_character": true, "target": "Five", "target_type": "person", "target_is_character": true, "action": "say", "consequence": "The gardeners warn Five", "text_describing_the_action": "“Look out now, Five! Don’t go splashing paint over me like that!”", "text_describing_the_consequence": "Five is warned about splashing paint", "location": ["garden", "rose-tree"], "temporal_order_id": 19}, "say": {"source": "Five", "source_type": "person", "source_is_character": true, "target": "gardeners", "target_type": "person", "target_is_character": true, "action": "say", "consequence": "Five expresses frustration", "text_describing_the_action": "“I couldn’t help it,” said Five, in a sulky tone; “Seven jogged my elbow.”", "text_describing_the_consequence": "Five is frustrated", "location": ["garden", "rose-tree"], "temporal_order_id": 20}, "say": {"source": "Seven", "source_type": "person", "source_is_character": true, "target": "Five", "target_type": "person", "target_is_character": true, "action": "say", "consequence": "Seven criticizes Five", "text_describing_the_action": "“That’s right, Five! Always lay the blame on others!”", "text_describing_the_consequence": "Seven is criticizing Five", "location": ["garden", "rose-tree"], "temporal_order_id": 21}, "say": {"source": "Five", "source_type": "person", "source_is_character": true, "target": "Seven", "target_type": "person", "target_is_character": true, "action": "say", "consequence": "Five warns Seven", "text_describing_the_action": "“You’d better not talk!” said Five. “I heard the Queen say only yesterday you deserved to be beheaded!”", "text_describing_the_consequence": "Seven is warned about the Queen", "location": ["garden", "rose-tree"], "temporal_order_id": 22}}}}\n</tool_call>'}}]}, 'logprobs': None, 'finish_reason': 'stop', 'stop_reason': None}], 'usage': {'prompt_tokens': 7067, 'total_tokens': 10169, 'completion_tokens': 3102, 'prompt_tokens_details': None}, 'prompt_logprobs': None}
test_9 ={'id': 'chatcmpl-81b967c3ba714f5db7baa16c5aaba208', 'object': 'chat.completion', 'created': 1742948582, 'model': 'Qwen/Qwen2.5-32B-Instruct', 'choices': [{'index': 0, 'message': {'role': 'assistant', 'reasoning_content': None, 'content': '', 'tool_calls': [{'id': 'chatcmpl-tool-135abecab02e437e977e4c649806c4e1', 'type': 'function', 'function': {'name': 'narrativeanalysis', 'arguments': '<tool_call>\n{"name": "narrativeanalysis", "arguments": {"text_id": "alice_in_wonderland", "entity_names": ["Alice", "guinea-pigs", "bottle", "lovely garden", "puppy", "stick", "thistle"], "entity_types": {"Alice": "person", "guinea-pigs": "animal", "bottle": "object", "lovely garden": "location", "puppy": "animal", "stick": "object", "thistle": "object"}, "character_entities": ["Alice", "guinea-pigs", "puppy"], "entity_mentions": {"Alice": ["Alice", "she", "her"], "guinea-pigs": ["guinea-pigs", "they"], "bottle": ["bottle"], "lovely garden": ["lovely garden"], "puppy": ["puppy", "it"], "stick": ["stick"], "thistle": ["thistle"]}, "locations": [["thick wood"], ["thistle"]], "location_descriptions": {"thick wood": "A thick wood where Alice finds herself safe", "thistle": "A great thistle behind which Alice hides"}, "action_names": ["rush", "run", "find", "wander", "say", "peer", "bark", "look", "stretch", "try", "whistle", "pick up", "hold out", "jump", "yelp", "rush", "worry", "dodge", "appear", "tumble", "run round", "charge", "sit down", "pant"}, "actions": {"rush": {"source": "guinea-pigs", "source_type": "animal", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "rush", "consequence": "Guinea-pigs move towards Alice", "text_describing_the_action": "They all made a rush at Alice the moment she appeared", "text_describing_the_consequence": "Guinea-pigs are moving towards Alice", "location": ["thick wood"], "temporal_order_id": 1}, "run": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "guinea-pigs", "target_type": "animal", "target_is_character": true, "action": "run", "consequence": "Alice escapes the guinea-pigs", "text_describing_the_action": "but she ran off as hard as she could", "text_describing_the_consequence": "Alice is running away from the guinea-pigs", "location": ["thick wood"], "temporal_order_id": 2}, "find": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "thick wood", "target_type": "location", "target_is_character": false, "action": "find", "consequence": "Alice is now in the thick wood", "text_describing_the_action": "and soon found herself safe in a thick wood", "text_describing_the_consequence": "Alice is now in the thick wood", "location": ["thick wood"], "temporal_order_id": 3}, "wander": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "thick wood", "target_type": "location", "target_is_character": false, "action": "wander", "consequence": "Alice is moving around in the thick wood", "text_describing_the_action": "as she wandered about in the wood", "text_describing_the_consequence": "Alice is moving around in the thick wood", "location": ["thick wood"], "temporal_order_id": 4}, "say": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "herself", "target_type": "person", "target_is_character": true, "action": "say", "consequence": "Alice verbalizes her thoughts", "text_describing_the_action": "said Alice to herself", "text_describing_the_consequence": "Alice is thinking about her plan", "location": ["thick wood"], "temporal_order_id": 5}, "peer": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "trees", "target_type": "object", "target_is_character": false, "action": "peer", "consequence": "Alice looks around among the trees", "text_describing_the_action": "while she was peering about anxiously among the trees", "text_describing_the_consequence": "Alice is looking around among the trees", "location": ["thick wood"], "temporal_order_id": 6}, "bark": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "bark", "consequence": "Alice hears the puppy\'s bark", "text_describing_the_action": "a little sharp bark just over her head", "text_describing_the_consequence": "Alice hears the bark", "location": ["thick wood"], "temporal_order_id": 7}, "look": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "puppy", "target_type": "animal", "target_is_character": true, "action": "look", "consequence": "Alice looks up at the puppy", "text_describing_the_action": "made her look up in a great hurry", "text_describing_the_consequence": "Alice is looking up at the puppy", "location": ["thick wood"], "temporal_order_id": 8}, "stretch": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "stretch", "consequence": "Puppy tries to touch Alice", "text_describing_the_action": "feebly stretching out one paw, trying to touch her", "text_describing_the_consequence": "Puppy is trying to touch Alice", "location": ["thick wood"], "temporal_order_id": 9}, "try": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "puppy", "target_type": "animal", "target_is_character": true, "action": "try", "consequence": "Alice attempts to whistle to the puppy", "text_describing_the_action": "she tried hard to whistle to it", "text_describing_the_consequence": "Alice is attempting to whistle to the puppy", "location": ["thick wood"], "temporal_order_id": 10}, "whistle": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "puppy", "target_type": "animal", "target_is_character": true, "action": "whistle", "consequence": "Alice makes a whistling sound", "text_describing_the_action": "she tried hard to whistle to it", "text_describing_the_consequence": "Alice is making a whistling sound", "location": ["thick wood"], "temporal_order_id": 11}, "pick up": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "stick", "target_type": "object", "target_is_character": false, "action": "pick up", "consequence": "Alice holds the stick", "text_describing_the_action": "Hardly knowing what she did, she picked up a little bit of stick", "text_describing_the_consequence": "Alice is holding the stick", "location": ["thick wood"], "temporal_order_id": 12}, "hold out": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "puppy", "target_type": "animal", "target_is_character": true, "action": "hold out", "consequence": "Alice offers the stick to the puppy", "text_describing_the_action": "and held it out to the puppy", "text_describing_the_consequence": "Alice is offering the stick to the puppy", "location": ["thick wood"], "temporal_order_id": 13}, "jump": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "stick", "target_type": "object", "target_is_character": false, "action": "jump", "consequence": "Puppy jumps towards the stick", "text_describing_the_action": "the puppy jumped into the air off all its feet at once, with a yelp of delight", "text_describing_the_consequence": "Puppy is jumping towards the stick", "location": ["thick wood"], "temporal_order_id": 14}, "yelp": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "Alice", "target_type": "person", "target_is_character": true, "action": "yelp", "consequence": "Puppy expresses delight", "text_describing_the_action": "with a yelp of delight", "text_describing_the_consequence": "Puppy is expressing delight", "location": ["thick wood"], "temporal_order_id": 15}, "rush": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "stick", "target_type": "object", "target_is_character": false, "action": "rush", "consequence": "Puppy moves towards the stick", "text_describing_the_action": "and rushed at the stick", "text_describing_the_consequence": "Puppy is moving towards the stick", "location": ["thick wood"], "temporal_order_id": 16}, "worry": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "stick", "target_type": "object", "target_is_character": false, "action": "worry", "consequence": "Puppy pretends to bite the stick", "text_describing_the_action": "and made believe to worry it", "text_describing_the_consequence": "Puppy is pretending to bite the stick", "location": ["thick wood"], "temporal_order_id": 17}, "dodge": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "puppy", "target_type": "animal", "target_is_character": true, "action": "dodge", "consequence": "Alice avoids being run over by the puppy", "text_describing_the_action": "Alice dodged behind a great thistle, to keep herself from being run over", "text_describing_the_consequence": "Alice is avoiding being run over by the puppy", "location": ["thistle"], "temporal_order_id": 18}, "appear": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "puppy", "target_type": "animal", "target_is_character": true, "action": "appear", "consequence": "Alice becomes visible to the puppy", "text_describing_the_action": "the moment she appeared on the other side", "text_describing_the_consequence": "Alice is now visible to the puppy", "location": ["thistle"], "temporal_order_id": 19}, "tumble": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "stick", "target_type": "object", "target_is_character": false, "action": "tumble", "consequence": "Puppy falls while trying to get the stick", "text_describing_the_action": "the puppy made another rush at the stick, and tumbled head over heels in its hurry to get hold of it", "text_describing_the_consequence": "Puppy is falling while trying to get the stick", "location": ["thistle"], "temporal_order_id": 20}, "run round": {"source": "Alice", "source_type": "person", "source_is_character": true, "target": "thistle", "target_type": "object", "target_is_character": false, "action": "run round", "consequence": "Alice moves around the thistle", "text_describing_the_action": "Alice ran round the thistle again", "text_describing_the_consequence": "Alice is moving around the thistle", "location": ["thistle"], "temporal_order_id": 21}, "charge": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "stick", "target_type": "object", "target_is_character": false, "action": "charge", "consequence": "Puppy makes short rushes at the stick", "text_describing_the_action": "the puppy began a series of short charges at the stick", "text_describing_the_consequence": "Puppy is making short rushes at the stick", "location": ["thistle"], "temporal_order_id": 22}, "sit down": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "ground", "target_type": "object", "target_is_character": false, "action": "sit down", "consequence": "Puppy is now sitting", "text_describing_the_action": "at last it sat down a good way off", "text_describing_the_consequence": "Puppy is now sitting", "location": ["thistle"], "temporal_order_id": 23}, "pant": {"source": "puppy", "source_type": "animal", "source_is_character": true, "target": "puppy", "target_type": "animal", "target_is_character": true, "action": "pant", "consequence": "Puppy is breathing heavily", "text_describing_the_action": "panting, with its tongue hanging out of its mouth, and its great eyes half shut", "text_describing_the_consequence": "Puppy is breathing heavily", "location": ["thistle"], "temporal_order_id": 24}}}}\n</tool_call>'}}]}, 'logprobs': None, 'finish_reason': 'stop', 'stop_reason': None}], 'usage': {'prompt_tokens': 7053, 'total_tokens': 10214, 'completion_tokens': 3161, 'prompt_tokens_details': None}, 'prompt_logprobs': None}
